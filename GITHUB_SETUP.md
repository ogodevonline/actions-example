# Настройка GitHub для CI/CD

В этом руководстве описаны шаги по настройке репозитория GitHub для корректной работы процессов развертывания.

## 1. Создание окружений (Environments)

Для разделения настроек между серверами разработки, тестирования и продакшена необходимо создать соответствующие окружения:

1. Перейдите в ваш репозиторий на GitHub.
2. Откройте вкладку **Settings** (Настройки).
3. В левом боковом меню выберите **Environments**.
4. Нажмите кнопку **New environment**.
5. Создайте по очереди три окружения с именами:
   - `dev`
   - `test`
   - `prod`

## 2. Настройка секретов для окружений

Для каждого созданного окружения (`dev`, `test`, `prod`) необходимо добавить секреты, которые будут использоваться для подключения к серверам.

1. В настройках конкретного окружения найдите раздел **Environment secrets**.
2. Нажмите **Add secret** и добавьте следующие переменные:
   - `SERVER_IP`: IP-адрес или домен вашего сервера.
   - `SSH_KEY`: Приватный SSH-ключ для доступа к серверу.
   - `USERNAME`: Имя пользователя на сервере (например, `ubuntu` или `root`).

*Примечание: Использование секретов на уровне окружений позволяет GitHub Actions автоматически выбирать нужные данные в зависимости от того, куда идет деплой.*

## 3. Запуск workflow вручную (workflow_dispatch)

Если в workflow настроен триггер `workflow_dispatch`, вы можете запускать его вручную:

1. Перейдите на вкладку **Actions** в вашем репозитории.
2. В списке слева выберите нужный workflow (например, "Deploy to Server").
3. Если workflow поддерживает ручной запуск, появится синяя панель с текстом: *"This workflow has a workflow_dispatch event trigger"*.
4. Нажмите кнопку **Run workflow**.
5. Выберите ветку и, если предусмотрено, укажите окружение (`dev`, `test` или `prod`).
6. Нажмите зеленую кнопку **Run workflow** для подтверждения.

## 4. Как GitHub Actions использует эти данные

Когда запускается процесс развертывания:

1. **Контекст окружения**: GitHub Actions определяет, какое окружение выбрано (через поле `environment` в YAML-файле).
2. **Подстановка секретов**: Система автоматически подгружает значения `SERVER_IP`, `SSH_KEY` и `USERNAME`, специфичные именно для этого окружения.
3. **Подключение**: Используя эти данные, workflow выполняет SSH-команды или передает файлы на целевой сервер.
4. **Безопасность**: Секреты никогда не отображаются в логах в открытом виде (они маскируются звездочками `***`).

